import math
import numpy as np

infectives_dict = {'2020-03-02': 8, '2020-03-03': 9, '2020-03-04': 12, '2020-03-05': 18, '2020-03-06': 19, '2020-03-07': 23, '2020-03-08': 26, '2020-03-09': 33, '2020-03-10': 49, '2020-03-11': 77, '2020-03-12': 117, '2020-03-13': 156, '2020-03-14': 184, '2020-03-15': 225, '2020-03-16': 280, '2020-03-17': 347, '2020-03-18': 440, '2020-03-19': 558, '2020-03-20': 697, '2020-03-21': 816, '2020-03-22': 919, '2020-03-23': 1139, '2020-03-24': 1368, '2020-03-25': 1596, '2020-03-26': 1883, '2020-03-27': 2139, '2020-03-28': 2435, '2020-03-29': 2755, '2020-03-30': 3152, '2020-03-31': 3537, '2020-04-01': 3908, '2020-04-02': 4327, '2020-04-03': 4658, '2020-04-04': 4966, '2020-04-05': 5207, '2020-04-06': 5510, '2020-04-07': 5847, '2020-04-08': 6153, '2020-04-09': 6462, '2020-04-10': 6773, '2020-04-11': 6984, '2020-04-12': 7182, '2020-04-13': 7414, '2020-04-14': 7692, '2020-04-15': 8003, '2020-04-16': 8331, '2020-04-17': 8654, '2020-04-18': 8925, '2020-04-19': 9121, '2020-04-20': 9415, '2020-04-21': 9694, '2020-04-22': 9955, '2020-04-23': 10211, '2020-04-24': 10480, '2020-04-25': 10674, '2020-04-26': 10822, '2020-04-27': 11010, '2020-04-28': 11212, '2020-04-29': 11411, '2020-04-30': 11574, '2020-05-01': 11753, '2020-05-02': 11896, '2020-05-03': 11978, '2020-05-04': 12082, '2020-05-05': 12255, '2020-05-06': 12358, '2020-05-07': 12451, '2020-05-08': 12567, '2020-05-09': 12646, '2020-05-10': 12706, '2020-05-11': 12798, '2020-05-12': 12878, '2020-05-13': 12946, '2020-05-14': 13015, '2020-05-15': 13099, '2020-05-16': 13156, '2020-05-17': 13200, '2020-05-18': 13267, '2020-05-19': 13344, '2020-05-20': 13397, '2020-05-21': 13454, '2020-05-22': 13516, '2020-05-23': 13563, '2020-05-24': 13600, '2020-05-25': 13631, '2020-05-26': 13678, '2020-05-27': 13737, '2020-05-28': 13781, '2020-05-29': 13822, '2020-05-30': 13856, '2020-05-31': 13881, '2020-06-01': 13914, '2020-06-02': 13955, '2020-06-03': 13983, '2020-06-04': 14023, '2020-06-05': 14049, '2020-06-06': 14075, '2020-06-07': 14090, '2020-06-08': 14127, '2020-06-09': 14158, '2020-06-10': 14187, '2020-06-11': 14215, '2020-06-12': 14232, '2020-06-13': 14252, '2020-06-14': 14265, '2020-06-15': 14293, '2020-06-16': 14323, '2020-06-17': 14345, '2020-06-18': 14359, '2020-06-19': 14365, '2020-06-20': 14367}

deaths = {'2020-03-02': 0, '2020-03-03': 1, '2020-03-04': 1, '2020-03-05': 1, '2020-03-06': 1, '2020-03-07': 1, '2020-03-08': 4, '2020-03-09': 5, '2020-03-10': 5, '2020-03-11': 7, '2020-03-12': 13, '2020-03-13': 18, '2020-03-14': 22, '2020-03-15': 27, '2020-03-16': 38, '2020-03-17': 46, '2020-03-18': 59, '2020-03-19': 67, '2020-03-20': 95, '2020-03-21': 108, '2020-03-22': 139, '2020-03-23': 172, '2020-03-24': 213, '2020-03-25': 261, '2020-03-26': 325, '2020-03-27': 397, '2020-03-28': 486, '2020-03-29': 578, '2020-03-30': 668, '2020-03-31': 791, '2020-04-01': 931, '2020-04-02': 1073, '2020-04-03': 1197, '2020-04-04': 1348, '2020-04-05': 1512, '2020-04-06': 1652, '2020-04-07': 1775, '2020-04-08': 1961, '2020-04-09': 2100, '2020-04-10': 2227, '2020-04-11': 2369, '2020-04-12': 2508, '2020-04-13': 2628, '2020-04-14': 2744, '2020-04-15': 2891, '2020-04-16': 2993, '2020-04-17': 3111, '2020-04-18': 3226, '2020-04-19': 3318, '2020-04-20': 3425, '2020-04-21': 3511, '2020-04-22': 3589, '2020-04-23': 3692, '2020-04-24': 3771, '2020-04-25': 3843, '2020-04-26': 3924, '2020-04-27': 3998, '2020-04-28': 4066, '2020-04-29': 4119, '2020-04-30': 4175, '2020-05-01': 4239, '2020-05-02': 4290, '2020-05-03': 4342, '2020-05-04': 4403, '2020-05-05': 4461, '2020-05-06': 4520, '2020-05-07': 4568, '2020-05-08': 4602, '2020-05-09': 4639, '2020-05-10': 4681, '2020-05-11': 4714, '2020-05-12': 4759, '2020-05-13': 4799, '2020-05-14': 4836, '2020-05-15': 4876, '2020-05-16': 4910, '2020-05-17': 4941, '2020-05-18': 4975, '2020-05-19': 5009, '2020-05-20': 5045, '2020-05-21': 5077, '2020-05-22': 5104, '2020-05-23': 5138, '2020-05-24': 5157, '2020-05-25': 5183, '2020-05-26': 5216, '2020-05-27': 5245, '2020-05-28': 5272, '2020-05-29': 5292, '2020-05-30': 5312, '2020-05-31': 5334, '2020-06-01': 5354, '2020-06-02': 5376, '2020-06-03': 5400, '2020-06-04': 5415, '2020-06-05': 5436, '2020-06-06': 5456, '2020-06-07': 5472, '2020-06-08': 5487, '2020-06-09': 5504, '2020-06-10': 5519, '2020-06-11': 5532, '2020-06-12': 5544, '2020-06-13': 5550, '2020-06-14': 5567, '2020-06-15': 5579, '2020-06-16': 5592, '2020-06-17': 5602, '2020-06-18': 5616, '2020-06-19': 5622, '2020-06-20': 5624}

davg = 0.891
recovered_dict = {date: round(death / davg) for date, death in zip(list(deaths.keys()), list(deaths.values()))}

population = 2607000
susceptibles_dict = {date: population - inf - rec for date, inf, rec in zip(list(deaths.keys()), list(infectives_dict.values()), list(recovered_dict.values()))}

susceptibles = list(susceptibles_dict.values())
infectives = list(infectives_dict.values())
recovered = list(recovered_dict.values())
dates = list(susceptibles_dict.keys())

def get_rho(sus, inf, s0):
    return (inf + sus - population) / math.log( sus / s0)

rho_values = [get_rho(sus, inf, susceptibles[0]) for sus, inf in zip(susceptibles[1:], infectives[1:])]

rho = sum(rho_values) / len(rho_values)
alpha = math.sqrt((susceptibles[0]/rho - 1) ** 2 + (2*susceptibles[0]*(population - susceptibles[0])) / (rho ** 2))
phi = np.arctanh([(susceptibles[0]/rho - 1) / alpha])[0]

def get_a(rec, t):
    x = ((rec*susceptibles[0]) / (rho*rho) - susceptibles[0]/rho + 1) / alpha
    tanhi = np.arctanh([x])[0]
    return ((phi + tanhi) * 2) / (alpha * t)

a_values = [get_a(recovered[t], t) for t in range(1, len(recovered[1:]))]
a = sum(a_values) / len(a_values)
r = a / rho

def get_values():
    return a, r
